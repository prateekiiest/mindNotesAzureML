{
  "cells": [
    {
      "cell_type": "code",
      "source": [
        "# azureml-core of version 1.0.72 or higher is required\n",
        "# azureml-dataprep[pandas] of version 1.1.34 or higher is required\n",
        "from azureml.core import Workspace, Dataset\n",
        "\n",
        "subscription_id = 'c01a4630-cc02-4828-9991-41259d9cb1a4'\n",
        "resource_group = 'bot-resource-group'\n",
        "workspace_name = 'MindNotesAnalysis'\n",
        "\n",
        "workspace = Workspace(subscription_id, resource_group, workspace_name)\n",
        "\n",
        "dataset = Dataset.get_by_name(workspace, name='UserDetails')\n",
        "df = dataset.to_pandas_dataframe()"
      ],
      "outputs": [],
      "execution_count": 1,
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "import json\n",
        "\n",
        "jsonData = json.loads(df[\"AppState\"][0])\n",
        "jsonData\n"
      ],
      "outputs": [
        {
          "output_type": "execute_result",
          "execution_count": 9,
          "data": {
            "text/plain": "{'currentApplicationState': {'shouldShowExpertFre': True,\n  'maxLoginAttempts': 0,\n  'lastTimeStateUpdated': '2021-03-01T12:18:03.599Z',\n  'isNewSession': False,\n  'shouldShowFre': False,\n  'sessionId': '7b1a2915-d74c-4fbd-aed2-b3f096ef44c9',\n  'userId': '5704b8c3-0e67-4127-4d78-08d8cc33525c'},\n 'currentUserState': {'loginState': {'showLoginFre': False,\n   'userInfo': {'scopes': ['https://www.googleapis.com/auth/userinfo.profile',\n     'https://www.googleapis.com/auth/userinfo.email'],\n    'serverAuthCode': None,\n    'idToken': 'eyJhbGciOiJSUzI1NiIsImtpZCI6ImZlZDgwZmVjNTZkYjk5MjMzZDRiNGY2MGZiYWZkYmFlYjkxODZjNzMiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiIzNDczODY2OTY2NTItMHM4MzVlNHY3a2VvYmhmNXU3M2Y2aGtuMDhlMzdjbzkuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJhdWQiOiIzNDczODY2OTY2NTItMWN0Y3NwbjNqY25waWs2MDg4a2U2N3ZrcGJlbXZrbXYuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJzdWIiOiIxMTI0MzI3ODc5MTA2MjIzNDIzNjQiLCJlbWFpbCI6ImNoYW5kYXJvYjIxQGdtYWlsLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJuYW1lIjoiUm9iIENoYW5kYSIsInBpY3R1cmUiOiJodHRwczovL2xoNC5nb29nbGV1c2VyY29udGVudC5jb20vLU5PUnBLc2VHLWpjL0FBQUFBQUFBQUFJL0FBQUFBQUFBQUFBL0FNWnV1Y2xRNnJubklZY01BLXN1dlRxWloydm9fd0lXekEvczk2LWMvcGhvdG8uanBnIiwiZ2l2ZW5fbmFtZSI6IlJvYiIsImZhbWlseV9uYW1lIjoiQ2hhbmRhIiwibG9jYWxlIjoiZW4iLCJpYXQiOjE2MTQ2MDkxMjgsImV4cCI6MTYxNDYxMjcyOH0.a3AeM5R1XvD9ZsqULyl3xlPima1WqoZ5hB0yNPu8EkgPM0so_QhVvzKn2IEGDfYZTsaRka7q9fkEMx4KIVR3mbbLTAn2JCndOBc5jnxHdCZxR0gPczoBTZ5TfhWcKnZ6nFtE7IK2Z-TNIhCl1OBzmScRSnLVB41AKMuOs8WcMm6sz66-CV4tSO1Kw1gjWvaV_tDIfvoxUU9jFd63BtysT8_qi7qnvAfIwfgBaBtaO3Zb3XEHbkBC_6KxvegEhpEighBxdGGf-jSFkMESYnuIvdnTTBemxunLmGuag6mNxzKH8f5RVIXjwH9-7OEYR6jK04arU6Af9NBX0xGbe-FUCg',\n    'user': {'photo': 'https://lh4.googleusercontent.com/-NORpKseG-jc/AAAAAAAAAAI/AAAAAAAAAAA/AMZuuclQ6rnnIYcMA-suvTqZZ2vo_wIWzA/s96-c/photo.jpg',\n     'email': 'chandarob21@gmail.com',\n     'familyName': 'Chanda',\n     'givenName': 'Rob',\n     'name': 'Rob Chanda',\n     'id': '112432787910622342364'}},\n   'loginStatus': True}},\n 'currentHomeScreenState': {'activeSection': {'ActiveCards': []},\n  'copingCrisisSection': {'CopingCrisisCards': []},\n  'homeSectionHeaders': [{'text': 'My Barriers to seek professional help',\n    'itemSection': 'homeBarriersHeader',\n    'colors': ['#D3ECFB', '#D3ECFB', '#D3ECFB'],\n    'locations': [1, 1, 1]},\n   {'text': 'My Self Discovery',\n    'itemSection': 'homeSelfDiscoveryHeader',\n    'colors': ['#FDDAC0', '#FDDAC0'],\n    'locations': [0.51, 0.51]},\n   {'text': 'Our suggestions for you',\n    'itemSection': 'homeInactiveHeader',\n    'colors': ['#ffffff', '#ffffff']}],\n  'inActiveSection': {'InActiveCards': [{'componentKey': 'letsTalk',\n     'title': 'Coping with Crisis',\n     'description': '',\n     'progress': 0,\n     'sectionImageShow': True,\n     'cardImageShow': True,\n     'sectionBodyDescriptionShow': True,\n     'sectionBodyIconShow': True,\n     'goto': 'copingWithCrisis',\n     'themeColor': '#B6AEDA',\n     'sectionHeaderRepresentative': {'text': 'My Coping with Crisis',\n      'itemSection': 'homeCopingCrisisHeader',\n      'colors': ['#E1BBFF', '#E1BBFF'],\n      'locations': [0.51, 0.51]}}]},\n  'barrierSection': {'BarrierCards': [{'componentKey': 'Prefer help from family or friends',\n     'title': 'Prefer help from family or friends',\n     'description': '',\n     'progress': 33.3,\n     'sectionImageShow': True,\n     'cardImageShow': True,\n     'sectionBodyDescriptionShow': True,\n     'sectionBodyIconShow': True,\n     'goto': 'barrierTwoFirst',\n     'themeColor': '#2D9CDB',\n     'progressBackgroundColor': '#D3ECFB'},\n    {'componentKey': 'Prefer help from family or friends',\n     'title': 'Prefer help from family or friends',\n     'description': '',\n     'progress': 33.3,\n     'sectionImageShow': True,\n     'cardImageShow': True,\n     'sectionBodyDescriptionShow': True,\n     'sectionBodyIconShow': True,\n     'goto': 'barrierTwoFirst',\n     'themeColor': '#2D9CDB',\n     'progressBackgroundColor': '#D3ECFB'},\n    {'componentKey': 'Others don’t think it’s a problem',\n     'title': 'Others don’t think it’s a problem',\n     'description': '',\n     'progress': 33.3,\n     'sectionImageShow': True,\n     'cardImageShow': True,\n     'sectionBodyDescriptionShow': True,\n     'sectionBodyIconShow': True,\n     'goto': 'barrierSix',\n     'themeColor': '#2D9CDB',\n     'progressBackgroundColor': '#D3ECFB'}]},\n  'selfDiscoverySection': {'SelfDiscoveryCards': [{'componentKey': 'HOME_SD_LEVEL_1',\n     'title': 'Weight of my problem',\n     'description': '',\n     'progress': 33.3,\n     'sectionImageShow': True,\n     'cardImageShow': True,\n     'sectionBodyDescriptionShow': True,\n     'sectionBodyIconShow': True,\n     'goto': 'sdLevel1',\n     'themeColor': '#FF9A51',\n     'progressBackgroundColor': '#FFD8BB'},\n    {'componentKey': 'HOME_SD_LEVEL_2',\n     'title': 'Familiar stories',\n     'description': '',\n     'progress': 33.3,\n     'sectionImageShow': True,\n     'cardImageShow': True,\n     'sectionBodyDescriptionShow': True,\n     'sectionBodyIconShow': True,\n     'goto': 'sdLevel2',\n     'themeColor': '#FF9A51',\n     'progressBackgroundColor': '#FFD8BB'}]}},\n 'selfDiscoveryState': {'showBackButtonModal': False,\n  'level3': {'isLocked': True,\n   'progressValue': 12.5,\n   'responses': {'GADSectionResponse': {},\n    'PHQSectionResponse': {},\n    'WsasResponse': {}},\n   'homeState': {'anxiousCard': {'completed': False, 'locked': True},\n    'lowCard': {'completed': False, 'locked': True},\n    'functioningCard': {'completed': False, 'locked': True},\n    'result': {'completed': False, 'locked': True},\n    'homeTypeChosen': None}},\n  'showIntro': False,\n  'sdLevel1ReportChosen': 'SECOND_REPORT_CHOSEN',\n  'level1': {'isLocked': False,\n   'responses': {'1': {'answer': 'a week', 'prev': None, 'next': 2},\n    '2': {'answer': 'rarely', 'prev': 1, 'next': 3},\n    '3': {'answer': 'rarely', 'prev': 2, 'next': 4},\n    '4': {'answer': 'not confident at all', 'prev': 3, 'next': None}},\n   'progressValue': 100},\n  'level2': {'progressValue': 12.5,\n   'isLocked': False,\n   'responses': {'VignetteSectionResponse': {},\n    'DiscoveringEmotionResponse': {'quid1': {'answer': {'quid1': {'1': False,\n        '2': False,\n        '3': True,\n        '4': False}},\n      'next': 'quid2',\n      'prev': 'quid1'}}}}},\n 'breakingBarrierState': {'showBackButtonModal': False,\n  'showSelectedMenu': True,\n  'expertVideoWatched': False,\n  'clientVideoWatched': False,\n  'currentBarrierIndex': 0,\n  'barriersState': {'It’s just a passing phase': {'responses': {}},\n   'Prefer help from family or friends': {'responses': {}},\n   'Counselling will mean I’m weak': {'responses': {}},\n   'Afraid how it affects my job or family': {'responses': {}},\n   'Fear of negative labels': {'responses': {}},\n   'Others don’t think it’s a problem': {'responses': {}},\n   'Difficult to get support to seek help': {'responses': {}},\n   'Talking might make it worse': {'responses': {}},\n   'Dislike talking about my feelings': {'responses': {}},\n   'Doubts about treatment options': {'responses': {'Doubts about treatment options': {}}},\n   'Afraid to consult a professional again': {'responses': {}},\n   'Doubtful if therapy helps': {'responses': {}},\n   'I don’t trust therapists': {'responses': {}},\n   'Inaccessibility of services': {'responses': {}},\n   'Professional help is costly': {'responses': {}},\n   'No time to consult': {'responses': {'No time to consult': {}}},\n   'Difficult to leave home': {'responses': {}}},\n  'showIntro': False,\n  'showMenu': False,\n  'completedBarriers': ['Prefer help from family or friends'],\n  'selectedBarriers': ['Others don’t think it’s a problem'],\n  'transitComponentList': ['barrierFeedback', 'barrierExpertVideo']},\n 'copingWithCrisisState': {'showIntro': True,\n  'showBackButtonModal': False,\n  'cclevel1': {'isLocked': False, 'progressValue': 100, 'responses': {}},\n  'cclevel2': {'isLocked': False, 'progressValue': 12.5, 'responses': {}},\n  'cclevel3': {'isLocked': True,\n   'progressValue': 12.5,\n   'responses': {'crisisStoreContact': {},\n    'crisisCreatePlan': {},\n    'crisisSendTrustedPersonMessage': {}}}},\n 'selfCriticalityState': {'showMainIntro': True,\n  'showBackButtonModal': False,\n  'showSelectedMenu': False,\n  'level1': {'isLocked': False, 'progressValue': 12.5, 'responses': {}},\n  'level2': {'isLocked': True, 'progressValue': 12.5, 'responses': {}},\n  'level3': {'isLocked': True,\n   'progressValue': 12.5,\n   'reminder': '',\n   'responses': {}}},\n 'managingWorryState': {'showMainIntro': True,\n  'showBackButtonModal': False,\n  'showSelectedMenu': False,\n  'level1': {'isLocked': False, 'progressValue': 12.5, 'responses': {}},\n  'level2': {'isLocked': True,\n   'progressValue': 12.5,\n   'startDate': '',\n   'endDate': '',\n   'time': '',\n   'duration': '',\n   'responses': {}},\n  'level3': {'isLocked': True, 'progressValue': 12.5, 'responses': {}}},\n 'negativeThoughtsState': {'showMainIntro': True,\n  'showBackButtonModal': False,\n  'showSelectedMenu': False,\n  'level1': {'isLocked': False, 'progressValue': 12.5, 'responses': {}},\n  'level2': {'isLocked': True, 'progressValue': 12.5, 'responses': {}},\n  'level3': {'isLocked': True, 'progressValue': 12.5, 'responses': {}}},\n 'calmingSoothingState': {'showMainIntro': True,\n  'showBackButtonModal': False,\n  'showSelectedMenu': False,\n  'level1': {'isLocked': False, 'progressValue': 12.5, 'responses': {}},\n  'level2': {'isLocked': True, 'progressValue': 12.5, 'responses': {}},\n  'level3': {'isLocked': True,\n   'progressValue': 12.5,\n   'reminder': '',\n   'responses': {}}},\n '_persist': {'version': -1, 'rehydrated': True}}"
          },
          "metadata": {}
        }
      ],
      "execution_count": 9,
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "barrierDf = jsonData[\"breakingBarrierState\"]\n",
        "\n",
        "barrierDf"
      ],
      "outputs": [
        {
          "output_type": "execute_result",
          "execution_count": 12,
          "data": {
            "text/plain": "{'showBackButtonModal': False,\n 'showSelectedMenu': True,\n 'expertVideoWatched': False,\n 'clientVideoWatched': False,\n 'currentBarrierIndex': 0,\n 'barriersState': {'It’s just a passing phase': {'responses': {}},\n  'Prefer help from family or friends': {'responses': {}},\n  'Counselling will mean I’m weak': {'responses': {}},\n  'Afraid how it affects my job or family': {'responses': {}},\n  'Fear of negative labels': {'responses': {}},\n  'Others don’t think it’s a problem': {'responses': {}},\n  'Difficult to get support to seek help': {'responses': {}},\n  'Talking might make it worse': {'responses': {}},\n  'Dislike talking about my feelings': {'responses': {}},\n  'Doubts about treatment options': {'responses': {'Doubts about treatment options': {}}},\n  'Afraid to consult a professional again': {'responses': {}},\n  'Doubtful if therapy helps': {'responses': {}},\n  'I don’t trust therapists': {'responses': {}},\n  'Inaccessibility of services': {'responses': {}},\n  'Professional help is costly': {'responses': {}},\n  'No time to consult': {'responses': {'No time to consult': {}}},\n  'Difficult to leave home': {'responses': {}}},\n 'showIntro': False,\n 'showMenu': False,\n 'completedBarriers': ['Prefer help from family or friends'],\n 'selectedBarriers': ['Others don’t think it’s a problem'],\n 'transitComponentList': ['barrierFeedback', 'barrierExpertVideo']}"
          },
          "metadata": {}
        }
      ],
      "execution_count": 12,
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "# Has user watched expert video.\n",
        "# later have userId as params\n",
        "def checkExpertVideoWatched():\n",
        "    return barrierDf['expertVideoWatched']\n",
        "\n",
        "\n",
        "# Has user watched client video.\n",
        "# later have userId as params\n",
        "def checkClientVideoWatched():\n",
        "    return barrierDf['clientVideoWatched']\n",
        "\n",
        "\n",
        "# Check which barriers have been watched by the user.\n",
        "# later have userId as params\n",
        "def checkBarriersWatched():\n",
        "    return barrierDf[\"completedBarriers\"]\n",
        "\n",
        "\n",
        "def checkBarrierResponses(barrierName):\n",
        "    if barrierName in barrierDf[\"barriersState\"][barrierName][\"responses\"]:\n",
        "        return barrierDf[\"barriersState\"][barrierName][\"responses\"][barrierName]\n",
        "    else :\n",
        "        return None\n",
        "\n",
        "\n"
      ],
      "outputs": [],
      "execution_count": 14,
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "checkBarrierResponses('Counselling will mean I’m weak') == None\n"
      ],
      "outputs": [
        {
          "output_type": "execute_result",
          "execution_count": 17,
          "data": {
            "text/plain": "True"
          },
          "metadata": {}
        }
      ],
      "execution_count": 17,
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "checkExpertVideoWatched()\n"
      ],
      "outputs": [
        {
          "output_type": "execute_result",
          "execution_count": 18,
          "data": {
            "text/plain": "False"
          },
          "metadata": {}
        }
      ],
      "execution_count": 18,
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "BarrierNoTimeToConsultActivities = checkBarrierResponses('No time to consult')\n"
      ],
      "outputs": [],
      "execution_count": 19,
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "barrierActivityList  = []\n",
        "for activityResponse in range(len(BarrierNoTimeToConsultActivities)):\n",
        "    barrierActivityList.append(BarrierNoTimeToConsultActivities[str(activityResponse + 1)]['answer'])"
      ],
      "outputs": [],
      "execution_count": 20,
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "barrierActivityList\n"
      ],
      "outputs": [
        {
          "output_type": "execute_result",
          "execution_count": 21,
          "data": {
            "text/plain": "[]"
          },
          "metadata": {}
        }
      ],
      "execution_count": 21,
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [],
      "outputs": [],
      "execution_count": null,
      "metadata": {}
    }
  ],
  "metadata": {
    "interpreter": {
      "hash": "cd2cf95eab98bc0aed90d7d4dceee09ebf5cdc1e2081a14507931389ba1690a4"
    },
    "kernelspec": {
      "name": "python3",
      "language": "python",
      "display_name": "Python 3"
    },
    "language_info": {
      "name": "python",
      "version": "3.6.9",
      "mimetype": "text/x-python",
      "codemirror_mode": {
        "name": "ipython",
        "version": 3
      },
      "pygments_lexer": "ipython3",
      "nbconvert_exporter": "python",
      "file_extension": ".py"
    },
    "orig_nbformat": 4,
    "kernel_info": {
      "name": "python3"
    },
    "nteract": {
      "version": "nteract-front-end@1.0.0"
    }
  },
  "nbformat": 4,
  "nbformat_minor": 2
}